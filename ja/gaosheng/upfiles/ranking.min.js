function Ranking(){this.init()}Ranking.prototype.init=function(){this.api_url="//asunaro-app.sakura.ne.jp/portfolio/api/ranking.php",this.send_data={max:10,queries:{type:"current",direction:"desc",page:0}}},Ranking.prototype.fetchData=function(){var self=this,lodaing=new Loading,type;lodaing.disp(),this.setSendQueries();var jsonp=new GetJsonp;jsonp.setUrl(this.api_url),jsonp.setData(this.send_data),jsonp.send_params.success=function(data_set){lodaing.close(),type=self.send_data.queries.type,$('.controls .sort-btn[data-type="'+type+'"]').addClass("active"),data_set.stocks.length?self.render(data_set):self.renderOffHour()},jsonp.send_params.error=function(){lodaing.close(),console.log("error")},jsonp.run()},Ranking.prototype.render=function(data_set){var $inner_sort_btns="",$body,$description,$updated,$ul,$li,$name,$metas,$table,$ratio,page,stocks,length,i,paging;for(type=this.send_data.queries.type,page=this.send_data.queries.page,direction=this.send_data.queries.direction,$body=$("<div>").addClass("section-body"),$description=$("<p>").addClass("description").html(this.getDescription()),$updated=$("<p>").addClass("updated").text("更新日："+replaceHyphenToSlash(removeSecondsFromDate(data_set.updated))),$ul=$("<ul>").addClass("ranking-items"),length=(stocks=data_set.stocks).length,i=0;i<length;i++)$li=$("<li>"),($name=$("<p>").addClass("stock-name")).text(stocks[i].stock_name+" ("+stocks[i].stock_code+")"),$metas=$("<div>").addClass("ranking-metas cf"),$table=this.getMetasTable(i,stocks),$ratio=this.getMetasRatio(i,stocks),$arrow=this.getArrow(i,stocks),$metas.append($table,$ratio,$arrow),$li.append($name,$metas),0===page&&i<3&&$li.append(this.getCrown(i)),$ul.append($li);$inner_sort_btns=this.renderInnerSortBtns(),$body.append($description,$inner_sort_btns,$updated,$ul),$(".ranking .controls").after($body),(new Paging).render(data_set.total,this.send_data.queries.page,this.send_data.max,$(".ranking-items"),12)},Ranking.prototype.getDescription=function(){var descriptions;return{current:"配信時株価と現在値推移で比較した騰落率ランキングです。",attention:"本日配信後最高値を更新した注目銘柄一覧です。売買ポイントや市況判断にご参考下さい。",ratio:"6ヶ月間の高安騰落率(高値・安値基準)を記録したランキングです。"}[this.send_data.queries.type]},Ranking.prototype.getMetasTable=function(i,stocks){var $table,$tr,$th,$td;return $table=$("<table>"),$tr=$("<tr>"),$th=$("<th>").text("配信日"),$td=$("<td>").attr("colspan","3").text(replaceHyphenToSlash(stocks[i].recommend_date)),$tr.append($th,$td),$table.append($tr),$tr=$("<tr>"),$th=$("<th>").text("配信時株価"),$td=$("<td>").text(stocks[i].recommend_value+"円"),$tr.append($th,$td),$th=$("<th>").text("現在値"),$td=$("<td>").text(stocks[i].current_value+"円"),$tr.append($th,$td),$table.append($tr),$tr=$("<tr>"),$th=$("<th>").text("配信後最安値"),$td=$("<td>").text(stocks[i].min_value+"円"),$tr.append($th,$td),$th=$("<th>").text("配信後最高値"),$td=$("<td>").text(stocks[i].max_value+"円"),$tr.append($th,$td),$table.append($tr),$table},Ranking.prototype.getMetasRatio=function(i,stocks){var $ratio,$title,$value,$note,type;return type=this.send_data.queries.type,direction=this.send_data.queries.direction,$ratio=$("<div>").addClass("ratio"),$title=$("<p>").addClass("title"),$value=$("<p>").addClass("value"),"current"===type?($title.text("現在値騰落率"),$value.text(stocks[i].current_ratio+"%")):"attention"===type?($title.text("最高値騰落率"),$value.text(stocks[i].max_ratio+"%")):"ratio"===type&&"desc"===direction?"買い"===stocks[i].technique?($title.text("最高値騰落率"),$value.text(stocks[i].max_ratio+"%")):($title.text("最安値騰落率"),$value.text(stocks[i].min_ratio+"%")):"ratio"===type&&"asc"===direction&&("買い"===stocks[i].technique?($title.text("最安値騰落率"),$value.text(stocks[i].min_ratio+"%")):($title.text("最高値騰落率"),$value.text(stocks[i].max_ratio+"%"))),$ratio.append($title,$value),"空売り"===stocks[i].technique&&($note=$("<p>").addClass("note").text("※売り推奨"),$ratio.append($note)),$ratio},Ranking.prototype.getArrow=function(i,stocks){var direction=this.send_data.queries.direction,type=this.send_data.queries.type,$p,$img,src;return $p=$("<p>").addClass("arrow"),src="/upfiles/pc-ranking-arrow-","current"===type&&(src+=stocks[i].current_ratio>0?"up.png":"down.png","0"===stocks[i].current_ratio&&(src="")),"attention"===type&&(src+=stocks[i].max_ratio>0?"up.png":"down.png","0"===stocks[i].max_ratio&&(src="")),"ratio"===type&&"desc"===direction&&(src+=stocks[i].max_ratio>0?"up.png":"down.png","0"===stocks[i].max_ratio&&(src="")),"ratio"===type&&"asc"===direction&&(src+=stocks[i].min_ratio>0?"up.png":"down.png","0"===stocks[i].min_ratio&&(src="")),$img=$("<img>").attr("src",src),$p.append($img)},Ranking.prototype.getCrown=function(i){var $p,$img,src;return src="/upfiles/pc-ranking-crown-"+(i+1)+".png",$p=$("<p>").addClass("crown"),$img=$("<img>").attr("src",src),$p.append($img)},Ranking.prototype.renderOffHour=function(){var $p=$("<p>");$p.addClass("off-hour-msg").text("このコンテンツは平日の10時以降に表示されます。"),$(".ranking .controls").after($p)},Ranking.prototype.renderInnerSortBtns=function(){var $inner_sort_btns="",type=this.send_data.queries.type,direction=this.send_data.queries.direction,ranking=location.href.match(/\/user\//)?"/user/ranking":"/ranking",$inner_sort_btn;return"ratio"===type&&($inner_sort_btns=$("<div></div>").addClass("inner-sort-btns"),$inner_sort_btn=$("<a>").attr("href",ranking+"?type=ratio&direction=desc").text("高値基準").addClass("btn"),"desc"===direction&&$inner_sort_btn.addClass("current"),$inner_sort_btns.append($inner_sort_btn),$inner_sort_btn=$("<a>").attr("href",ranking+"?type=ratio&direction=asc").text("安値基準").addClass("btn"),"asc"===direction&&$inner_sort_btn.addClass("current"),$inner_sort_btns.append($inner_sort_btn)),$inner_sort_btns},Ranking.prototype.setSendQueries=function(){var self=this,queries=getUrlQueries(),type=["current","attention","ratio"],num;$.each(queries,(function(key,value){"type"===key?self.send_data.queries.type=type.indexOf(value)>-1?value:"current":"direction"===key?self.send_data.queries.direction=value:"page"===key&&(value=parseInt(value),num=!isFinite(value)||value<=0?1:value,self.send_data.queries.page=num-1)}))},$(document).on("click",".ranking .paging a",(function(){var current,query;return(current=getUrlQueries()).page=parseInt($(this).attr("href"),10),query=buildUrlQuery(current),window.location.href=getUrl()+"?"+query,!1}));